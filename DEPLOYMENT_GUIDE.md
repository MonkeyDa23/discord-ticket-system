# دليل النشر الشامل - نظام إدارة التذاكر على Railway

## المتطلبات الأساسية

### 1. إعداد GitHub Repository
```bash
# خطوات رفع المشروع على GitHub:
1. إنشاء repository جديد على GitHub
2. رفع جميع ملفات المشروع
3. التأكد من وجود ملف .gitignore
```

### 2. حساب Railway
- الذهاب إلى: https://railway.app
- التسجيل باستخدام GitHub (مستحسن)
- ربط حساب GitHub بـ Railway

## خطوات النشر التفصيلية

### الخطوة 1: إنشاء مشروع جديد
```
1. تسجيل الدخول إلى Railway
2. النقر على "New Project"
3. اختيار "Deploy from GitHub repo"
4. اختيار المشروع من قائمة repositories
5. Railway سيبدأ بتحليل المشروع تلقائياً
```

### الخطوة 2: إضافة قاعدة البيانات PostgreSQL
```
1. في لوحة تحكم المشروع
2. النقر على "New Service"
3. اختيار "Database"
4. اختيار "PostgreSQL"
5. Railway سينشئ قاعدة بيانات وسيعطي DATABASE_URL
```

### الخطوة 3: تكوين متغيرات البيئة
في قسم "Variables" أضف المتغيرات التالية:

#### المتغيرات الأساسية (مطلوبة):
```
NODE_ENV=production
SESSION_SECRET=generate_random_32_char_string_here
```

#### مفاتيح Discord (لتفعيل الإشعارات):
```
DISCORD_BOT_TOKEN=your_bot_token_here
DISCORD_CHANNEL_ID=your_notification_channel_id
DISCORD_GUILD_ID=your_server_guild_id
```

#### إعدادات إضافية (اختيارية):
```
SENDGRID_API_KEY=your_sendgrid_key_for_emails
```

### الخطوة 4: إعداد قاعدة البيانات
```sql
-- Railway سيقوم بإنشاء قاعدة البيانات تلقائياً
-- الجداول ستُنشأ عند أول تشغيل للتطبيق
-- تتضمن:
-- - جدول المستخدمين مع نظام الموافقة
-- - جدول التذاكر مع التفاصيل الكاملة
-- - جدول المراجعات والتقييمات
-- - جدول إعدادات البوت
-- - جدول الأنشطة والسجلات
```

### الخطوة 5: النشر والتفعيل
```
1. Railway سيبدأ النشر تلقائياً
2. انتظار اكتمال عملية البناء (3-5 دقائق)
3. الحصول على الرابط العام
4. اختبار التطبيق
```

## الحصول على الرابط النهائي

### الرابط الافتراضي:
```
your-app-production-abc123.railway.app
```

### إعداد رابط مخصص (اختياري):
```
1. في إعدادات المشروع
2. قسم "Domains"
3. إضافة custom domain
4. ربط النطاق المملوك
```

## إعداد Discord Bot (للإشعارات)

### 1. إنشاء Discord Application:
```
1. الذهاب إلى: https://discord.com/developers/applications
2. النقر على "New Application"
3. إدخال اسم التطبيق
4. حفظ Application ID (هذا هو DISCORD_GUILD_ID)
```

### 2. إنشاء Bot:
```
1. في صفحة التطبيق، النقر على "Bot"
2. النقر على "Add Bot"
3. نسخ Bot Token (هذا هو DISCORD_BOT_TOKEN)
4. تفعيل "MESSAGE CONTENT INTENT"
```

### 3. دعوة البوت للسيرفر:
```
1. في قسم "OAuth2" > "URL Generator"
2. اختيار "bot" في Scopes
3. اختيار الصلاحيات: Send Messages, Read Messages
4. نسخ الرابط المولد ودعوة البوت
```

### 4. الحصول على Channel ID:
```
1. تفعيل Developer Mode في Discord
2. النقر بزر الماوس الأيمن على القناة المرغوبة
3. اختيار "Copy ID"
4. هذا هو DISCORD_CHANNEL_ID
```

## اختبار النظام بعد النشر

### 1. فحص الحالة الأساسية:
```
GET https://your-app.railway.app/api/health
```

### 2. اختبار قاعدة البيانات:
```
GET https://your-app.railway.app/api/stats
```

### 3. تسجيل الدخول الإداري:
```
المستخدم: admin
كلمة المرور: admin123
```

## إعدادات الأمان المتقدمة

### 1. تشفير البيانات:
- جميع المتغيرات مشفرة في Railway
- اتصال HTTPS تلقائي
- قاعدة بيانات محمية

### 2. إخفاء الرابط:
```
# خيارات إضافية للحماية:
1. استخدام Cloudflare للحماية من DDoS
2. إعداد custom domain لإخفاء اسم Railway
3. تفعيل Basic Auth للحماية الإضافية
```

### 3. النسخ الاحتياطية:
```
# Railway يقوم بنسخ احتياطية تلقائية
# يمكن تنزيل backup يدوياً من لوحة التحكم
```

## استكشاف الأخطاء

### مشاكل شائعة وحلولها:

#### 1. فشل الاتصال بقاعدة البيانات:
```
الحل: التأكد من صحة DATABASE_URL في المتغيرات
```

#### 2. عدم عمل إشعارات Discord:
```
الحل: فحص صحة DISCORD_BOT_TOKEN و الصلاحيات
```

#### 3. بطء في التحميل:
```
الحل: Railway قد يحتاج وقت للبدء، انتظار 30 ثانية
```

## الصيانة والتحديثات

### 1. تحديث الكود:
```
# أي push جديد على GitHub سيؤدي لإعادة نشر تلقائية
git push origin main
```

### 2. مراقبة الأداء:
```
# استخدام لوحة تحكم Railway لمراقبة:
- استخدام المعالج
- استخدام الذاكرة  
- طلبات الشبكة
- أخطاء التطبيق
```

### 3. النسخ الاحتياطية الدورية:
```
# تنزيل backup من قاعدة البيانات شهرياً
# حفظ نسخة من المتغيرات المهمة
```

## التكاليف المتوقعة

### Railway Pricing:
```
- Hobby Plan: $5/شهر للتطبيقات الصغيرة
- Pro Plan: $20/شهر للتطبيقات المتوسطة
- الاستخدام الأولي مجاني حتى $5
```

## نصائح للحصول على أفضل أداء

### 1. تحسين قاعدة البيانات:
```sql
-- إنشاء indexes للاستعلامات السريعة
CREATE INDEX idx_tickets_status ON tickets(status);
CREATE INDEX idx_users_email ON users(email);
```

### 2. تحسين الذاكرة:
```javascript
// Railway يخصص 512MB افتراضياً
// يمكن زيادتها في الإعدادات إذا لزم الأمر
```

### 3. مراقبة الأخطاء:
```javascript
// النظام يتضمن logging مدمج
// مراجعة Railway logs دورياً
```